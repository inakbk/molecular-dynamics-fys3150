\documentclass[11pt,a4wide]{article}
\usepackage{verbatim}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{a4wide}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[dvips]{epsfig}
\usepackage[T1]{fontenc}
\usepackage{cite} % [2,3,4] --> [2--4]
\usepackage{shadow}
\usepackage{hyperref}
\usepackage[squaren]{SIunits}

\setcounter{tocdepth}{2}
\usepackage{url} %url + line break
\usepackage[labelfont=bf]{caption} %for bold captions (figure ++)

\renewcommand{\vec}{\mathbf}
\newcommand{\dm}[1]{\mathrm{d}#1}
\newcommand{\ihat}{\hat{\textbf{\i}}}
\newcommand{\jhat}{\hat{\textbf{\j}}}
\newcommand{\khat}{\hat{\textbf{k}}}
\providecommand{\e}[1]{\ensuremath{\times 10^{#1}}}


\lstset{language=c++}
\lstset{alsolanguage=[90]Fortran}
\lstset{basicstyle=\small}
\lstset{backgroundcolor=\color{white}}
\lstset{frame=single}
\lstset{stringstyle=\ttfamily}
\lstset{keywordstyle=\color{red}\bfseries}
\lstset{commentstyle=\itshape\color{blue}}
\lstset{showspaces=false}
\lstset{showstringspaces=false}
\lstset{showtabs=false}
\lstset{breaklines}


%lager heftig forside:
\newcommand*{\titleAT}{\begingroup % Create the command for including the title page in the document
\newlength{\drop} % Command for generating a specific amount of whitespace
\drop=0.1\textheight % Define the command as 10% of the total text height

\rule{\textwidth}{1pt}\par % Thick horizontal line
\vspace{2pt}\vspace{-\baselineskip} % Whitespace between lines
\rule{\textwidth}{0.4pt}\par % Thin horizontal line

\vspace{0.5\drop} % Whitespace between the top lines and title
\centering % Center all text
\textcolor{black}{ % Red font color
{\Huge Atomic modeling of argon}\\[0.75\baselineskip] % Title line 1
%{\Large Tema:}\\[0.75\baselineskip] % Title line 2
%{\Huge Lydmåling og hørselstesting} % Title line 3
} 

\vspace{0.25\drop} % Whitespace between the title and short horizontal line
\rule{0.3\textwidth}{0.4pt}\par % Short horizontal line under the title
\vspace{0.25\drop} % Whitespace between the thin horizontal line and the author name

{\Large \textsc{Project 5, FYS-3150\\[0.75\baselineskip] \normalsize{Ina K. B. Kullmann, candidate nr: 20}
}}\par % Author name

%\vfill % Whitespace between the author name and publisher text

\vspace{0.25\drop} % Whitespace between the title and short horizontal line
\rule{0.3\textwidth}{0.4pt}\par % Short horizontal line under the title
\vspace{0.25\drop} % Whitespace between the thin horizontal line and the author name

\begin{abstract}
Goal: Find the melting temperature of the solid.

The aim of this project is to numerically find the critical temperature for the two dimentional Ising model by using the metropolis algorithm. We will first test the implementation of the algorithm carefully, first by comparing with theoretical values calculated for a small system. Then we will see if the algorithm behaves as expected according to our physical intuition for a larger system.

When we have found a estimate for the critical temperature we will compare it to Lars Onsagers analytical result.

\end{abstract}
\vspace*{0.25\drop} % Whitespace under the publisher text

\begin{center}
{ \scriptsize \noindent All source codes can be found at: \url{https://github.com/inakbk/molecular-dynamics-fys3150}. }
\end{center}

\rule{\textwidth}{0.4pt}\par % Thin horizontal line
\vspace{2pt}\vspace{-\baselineskip} % Whitespace between lines
\rule{\textwidth}{1pt}\par % Thick horizontal line

\endgroup}
%kode slutt for heftig forside


\begin{document}
%\maketitle
\titleAT % This command includes the title page


\newpage
\tableofcontents
\newpage

\section{Introduction}

Molecular dynamics (MD) is a computer simulation method used to study atoms and molecule structure and movement. In a MD simulation the atoms or molecules are allowed to interact through a force given by a potential for a limited time. This makes it possible to study the system evolving in time. The applications of MD is many ranging from chemical physics, materials science and the modelling of biomolecules\footnote{\url{https://en.wikipedia.org/wiki/Molecular\_dynamics\#Areas\_of\_application\_and\_limitations}, 11.dec 12:00}.

Molecular dynamics is often used to study stastistical properties of a system consisting of a large number of atoms or molecules and thus MD is a a type of N-body simulation. For systems that obey the ergodic hypothesis\footnote{\url{https://en.wikipedia.org/wiki/Ergodic\_hypothesis} 11.dec 11:30} the evolution of a single molecular dynamics simulation may be used to determine macroscopic thermodynamic properties of the system. This is because the time averages of an ergodic system correspond to microcanonical (NVE) ensemble averages\footnote{\url{https://en.wikipedia.org/wiki/Molecular\_dynamics} 3.dec 11:25}. In this paper we wil study one such NVE ensemple, a system with constant number of particles (N), constant volume (V) and constant total energy (E). 

Often the main motivation to use Molecular dynamics is that it is not possible to determine the properties of the system analytically, mainly because of the large number of particles. Therefore one have to apply numerical methods to be able to solve the problem. One of the main limitation for the numerical simulation is the computer recources available limiting the number of particles and the system size. The latter problem can be solved by applying periodic boundary conditions so that it is possible to simulate a system with infinite size. The first problem might be solved with a very efficient code and good approximations. Another problem with the numerical simulation is cumulative errors in the numerical integration when evolving the system in time, often drift in the total energy. This error can be avoided by proper selection of parameters and integration algorithms. In this paper we will have a look at two numerical integration methods; the Euler-Cromer method and the Velocity Verlet integrator. We will also use a set of units that we will refer to as 'MD units' to aviod calculations with small exponents. 

In this project we will study the properties of a large system consisting of Argon atoms initially placed in a cubic lattice and try to determine the melting temperature of the solid. We are interested in the statistical properties of the system such as the mean square displacement and the diffusion constant. We will also have a quick look at the energy development in time. The individual motion of each particle is not of any physical interest, but we will look at the simulation with an visualization program to gain physical understanding of the system and to verify the implementation of the models and algorithms. 

This report is organizen in bla bla...sections (??)
first the theory with the equations used to biuld up the algorithm
%And compare with experimental data(?).  

\newpage
\section{Theory}

\subsection{Creating the lattice} \label{sec: creating_lattice_theory} 
We want to start out the simulation with the atoms in a crystal structure and will choose the face-centered cubic (FCC) lattice. Later we will learn that the FFC lattice is a stable structure for the Lennard-Jones potential that we will use in the simulation. The lattice is build up by unit cells, a group of attoms, so that a larger system can be created by repeating these cells in space. The FFC lattice unit cell is of size $b \angstrom $ and consists of four atoms with local coordinates
\begin{align}
	\vec r_1 &= 0 \ihat + 0 \jhat + 0 \khat,\\
	\vec r_2 &= \frac{b}{2} \ihat + \frac{b}{2} \jhat + 0 \khat,\\
	\vec r_3 &= 0 \ihat + \frac{b}{2} \jhat + \frac{b}{2} \khat,\\
	\vec r_4 &= \frac{b}{2} \ihat + 0 \jhat + \frac{b}{2} \khat.
\end{align}
where $b=5.26 \angstrom$ is the lattice constant. We want to construct a larger system with $N\times N\times N$ such unit cells next to each other. The orgin of unit cell $(i,j,k)$ is
\begin{align}
	\vec R_{i,j,k} = i \hat{\textbf{u}}_1 + j \hat{\textbf{u}}_2 + k \hat{\textbf{u}}_3,
\end{align}
where $i=0,1,..., N_x-1, j=0,1,..., N_y-1, k=0,1,..., N_z-1$. The unit vectors of the unit cells are scaled with the lattice constant $b$ so that
\begin{align}
	\hat{\textbf{u}}_1 = b\ihat, \quad \hat{\textbf{u}}_2 = b\jhat, \quad \hat{\textbf{u}}_3 = b\khat.
\end{align}
The coordinates of particle one to four is then given by:

\begin{minipage}{0.2\textwidth}
\begin{align*}
x_1 &= 0 + ib\\
y_1 &= 0 + jb \\
z_1 &= 0 + kb
\end{align*}
\smallskip
\end{minipage}
\begin{minipage}{0.25\textwidth}
\begin{align*}
x_2 &= \frac{1}{2} + ib\\
y_2 &= \frac{1}{2} + jb \\
z_2 &= 0 + kb
\end{align*}
\smallskip
\end{minipage}
\begin{minipage}{0.25\textwidth}
\begin{align*}
x_3 &= 0 + ib\\
y_3 &= \frac{1}{2} + jb \\
z_3 &= \frac{1}{2} + kb
\end{align*}
\smallskip
\end{minipage}
\begin{minipage}{0.25\textwidth}
\begin{align*}
x_4 &= \frac{1}{2} + ib\\
y_4 &= 0 + jb \\
z_4 &= \frac{1}{2} + kb
\end{align*}
\smallskip
\end{minipage}
In figure \ref{fig: ar_crystal} we see an illustration of two unit cells placed side by side. A cubic lattice is formed by placing $N\times N \times N$ such unit cells side by side. 

\begin{figure}
\centering
\includegraphics[width=0.3\textwidth]{plots/crystal}
\caption{An illustration of the desired crystal structure when simulation an Argon crystal. The length of the sides of the unit cells used in this paper have half the length of the yellow box marked in the drawing.}
\label{fig: ar_crystal}
\end{figure}


Each of the sides of the simulation box has the length $L = bN$ so that the size of the whole system or the volume of the cubic lattice is given by $V = L^3 = (bN)^3$ which is constant as long as $b$ and $N$ is constant. The number of unit cells in each direction $N$ is also a measure of the number of particles in the system because it is 4 particles in each unit cells. The total number of particles in the simulation box is therefore $4N^3$. The mass density of the system is then:
\[
\rho_m = \frac{M_{tot}}{V} = \frac{4*N^3*m}{(bN)^3} = \frac{4m}{b^3}
\]
where $m$ is the mass of one atom and is equal for all the atoms. The particle density is then:
\[
\rho = \frac{4N^3}{(bN)^3} = \frac{4}{b^3}
\]
We can see that both the mass and particle density will be constant as long as the mass and the lattice constant is held constant in the simulation. We therefore see that we have constructed a NVE ensemble since the number of particles and the volume is constant in the simulation. The system will not interact with any surroundings implying a conserved total energy. 

\subsection{Giving the particles initial velocities}
The atoms are usually given velocities according to the Maxwell-Boltzmann distribution:
\begin{align}
	\label{eq:maxwell_boltzmann}
	P(v_i)\dm{v_i} = \left(\frac{m}{2\pi k_B T}\right)^{1/2} \exp\left(-\frac{m v_i^2}{2k_B T}\right) \dm{v_i},
\end{align}
where $m$ is the mass of the atom, $k_B$ is Boltzmann's constant and $T$ is the temperature. We recognize this as a normal distribution with zero mean and standard deviation $\sigma = \sqrt{k_B T/m}$. 

The Maxwell-Boltzmann distribution describes particle speeds of ideal gasses where the particles move freely inside a stationary container. An ideal gass is an simplification of real gasses where the particles is assumed to not interact with one another except for very brief collisions in which they exchange energy and momentum with each other or with their thermal environment. The system of particles is also assumed to have reached thermodynamic equilibrium\footnote{\url{https://en.wikipedia.org/wiki/Maxwell–Boltzmann\_distribution}}.

In real gases and in the Argon gass that we will study there are various effects such as van der Waals interactions. These effects imply that the gass does not fulfill the asumptions of an ideal gas. However the ideal gas is often a good approximation implying that the Maxwell speed distribution is also an good approximation. The distribution also depends on the temperature of the system and the mass of the particle which is beneficial in our case. We will therefore use the Maxwell-Boltzmann distribution to give initial velocities to the particles in the simulation. 

Using the Maxwell-Boltzmann distribution to give initial velocities to the particles will result in a nonzero net momentum in the system. We will therefore remove this total momentum right after the initial velocities have been given. 

The momentum in a given direction $i$ for one atom is $p_{i} = mv_i$ where the mass is $m$ and $v_i$ is the velocity in direction $i$. The total momentum in one direction, assuming that all particles have the same mass, is given by:
\[
p_{tot} = m(v_{i,1} + v_{i,2} + v_{i,3} + \dots + v_{i,n})
\]
where $n$ is the total number of atoms in the simulation. 

We want to remove this momentum evenly from all the particles. The momentum we want to remove from each particle is then:
\[
p_{rm} = \frac{p_{tot}}{n}
\]
so that $p_i'$ is the momentum for one particle after removing the total momentum:
\[
p_i' = p_i - p_{rm}.
\]
If we write this out
\begin{align*}
mv_i' &= mv_i - \frac{m(v_{i,1} + v_{i,2} + v_{i,3} + \dots + v_{i,n})}{n} \\
\Rightarrow v_i' &= v_i - \frac{v_{i,1} + v_{i,2} + v_{i,3} + \dots + v_{i,n}}{n} \\
&= v_i - \overline{v_i}
\end{align*}
we see that to remove the total momentum one only have to substract the average velocity from each of the particles velocity. 

\subsection{Periodic boundaryconditions (PBCs)} 
To avoid problems with boundary effects we will apply periodic boundary conditions. This has a great analogy to 'old' video games such as Snake 2. If the snake head passes through one side of box, it re-appears on the opposite side with the same velocity. In the system of atoms this would mean that if an atom should leave the simulation box at one side it will enter on the oposite side with the same values for the physical parameters as it had before it left. This also implies that an attom at the edge of the box will interact with an atom at the opposite side of the box so that every atom have the same number of 'neighbours'. 

MD simulations that use periodic boundary conditions have a large number of unit cells (defined above?), a group of atoms, so that a larger system can be created by repeating these cells in space. 

The size of the simulation box must also be large enough to prevent unphysical behaviour. If the box is too small one unit cell (a few atoms) might interact with itself. In the Snake analogy this would mean that the "head" interacts with or bites its own "tail" trough the wall which is allowed in the game, but not very physical. Thus the box size have to be large enough relative to the size of a unit cell, length of the simulation and the desired accuracy\footnote{\url{https://en.wikipedia.org/wiki/Periodic\_boundary\_conditions\#Practical\_implementation:\_continuity\_and\_the\_minimum\_image\_convention}}.


\subsection{Intergration methods} \label{sec: int_methods}
During the first implementation of the MD code we have used the Euler-Cromer method to find the next time step for the atoms. (bla bla legge til likninger?)

In MD the Velocity Verlet integrator is usually used. This is because other integration algorithms tend to drift the energy over time, which we want to avoid. The Velocity Verlet algorithm consists of three steps (in addition to computing the forces, see section \ref{sec: L-Jpot_forces})
\begin{align}
	\vec v(t + \Delta t/2) &= \vec v(t) + \frac{\vec F(t)}{m}\frac{\Delta t}{2}\\
	\vec r(t + \Delta t) &= \vec r(t) + \vec v(t + \Delta t/2)\Delta t\\
	\vec v(t + \Delta t) &= \vec v(t + \Delta t/2) + \frac{\vec F(t + \Delta t)}{m}\frac{\Delta t}{2}.
\end{align}

sympletic integrator bla bla bla?

To measure the drift of the energy we will use the standard deviation of the total energy $E$:
\[
\sigma_E = \sqrt{\langle E^2 \rangle - \langle E \rangle^2}
\]
that we will calculate using the Euler-Cromer method and the Velocity-Verlet integrator and compare the results.

Will also compare cumputing time (plot this!?)

say something more about energy drift?

(discussed in the lecture notes.?)
  see \url{https://en.wikipedia.org/wiki/Verlet\_integration\#Velocity\_Verlet} on conserved quantities
  
bla bla bla  

\subsection{The Lennard-Jones potential (interaction/forces)} \label{sec: L-Jpot_forces}

In this project we will use the Lennard-Jones potential which is a mathematically simple model that approximates the interaction between a pair of neutral atoms or molecules. Due to its computational simplicity, the Lennard-Jones potential is used extensively in computer simulations even though more accurate potentials exist\footnote{\url{http://en.wikipedia.org/wiki/Lennard-Jones_potential}}.

The potential calculates the energy between two atoms $i$ and $j$ as
\begin{align}
	U(r_{ij}) = 4\epsilon\left[\left(\frac{\sigma}{r_{ij}}\right)^{12} - \left(\frac{\sigma}{r_{ij}}\right)^6\right],
\end{align}
where $r_{ij} = |\vec r_i - \vec r_j|$ is the distance from atom $i$ to atom $j$, $\epsilon$ is the depth of the potential well (units energy) and $\sigma$ is the distance at which the potential is zero. 

The parameters in the potential can be fitted to reproduce experimental data. For argon, optimal values of the parameters are:
\begin{align}
	\frac{\epsilon}{k_B} = \unit{119.8}{\kelvin}, \sigma=\unit{3.405}{\angstrom}.
\end{align}
With these parameters the L-J potential reproduces equilibrium thermodynamic properties that are in good agreement with experimental values for argon.

In our code, we use the so called MD units (see appendix \ref{sec:units}). (finne enheten og verdier til parameterne?)

%The equation of state for this system is the van der Waals equation of state. Phases such as solid, liquid and gas are reproduced from this simple model with phase transitions and everything which is remarkable.(?)

The force is calculated by taking the negative gradient of the potential
\begin{align}
	\vec F(r_{ij}) = -\nabla U(r_{ij}),
\end{align}
giving the $x$-component (the other components are calculated the same way)
\begin{align}
	F_x(r_{ij}) = -\frac{\partial U}{\partial r_{ij}}\frac{\partial r_{ij}}{\partial x_{ij}},
\end{align}
where $x_{ij}$ is the $x$-component of $\vec r_{ij}$. Calculating the differensials separately:
\begin{align*}
\frac{\partial U}{\partial r_{ij}} &= \frac{\partial }{\partial r_{ij}} 4\epsilon\Big[\Big(\frac{\sigma}{r_{ij}}\Big)^{12} - \Big(\frac{\sigma}{r_{ij}}\Big)^6 \Big] =  4\epsilon\Big[ \sigma^{12}\frac{\partial }{\partial r_{ij}} r_{ij}^{-12} - \sigma^6 \frac{\partial }{\partial r_{ij}}r_{ij}^{-6} \Big] \\
&= 4\epsilon\Big[ -12\sigma^{12} r_{ij}^{-13} -(-6) \sigma^6 r_{ij}^{-7} \Big] = \frac{24\epsilon}{\sigma} \Big[\Big(\frac{\sigma}{r_{ij}}\Big)^{7} - 2\Big(\frac{\sigma}{r_{ij}}\Big)^{13} \Big] \\
r_{ij} &= |\vec{r_i} - \vec{r_j} | = | x_i\ihat + y_i\jhat + z_i\khat - x_j\ihat + y_j\jhat + z_j\khat | = | (x_i - x_j)\ihat + (y_i - y_j)\jhat + (z_i - z_j)\khat | \\
&= \sqrt{(x_i - x_j)^2 + (y_i - y_j)^2 + (z_i - z_j)^2} = \sqrt{x_{ij}^2 + y_{ij}^2 + z_{ij}^2} \\
\frac{\partial r_{ij}}{\partial x_{ij}} &= \frac{\partial}{\partial x_{ij}} \sqrt{x_{ij}^2 + y_{ij}^2 + z_{ij}^2} = \frac{1}{2r_{ij}}\cdot 2x_{ij} = \frac{x_{ij}}{r_{ij}}
\end{align*}
gives
\begin{align*}
F_x(r_{ij}) &= -\frac{24\epsilon}{\sigma} \Big[\Big(\frac{\sigma}{r_{ij}}\Big)^{7} - 2\Big(\frac{\sigma}{r_{ij}}\Big)^{13} \Big]\cdot \frac{x_{ij}}{r_{ij}} \\
&= \frac{24\epsilon}{\sigma^2} \Big[2\Big(\frac{\sigma}{r_{ij}}\Big)^{14} - \Big(\frac{\sigma}{r_{ij}}\Big)^{8} \Big]x_{ij}
\end{align*}
The force in y and z direction can be calculated the same way giving:
\begin{align*}
\vec F &= F_x\ihat + F_y \jhat + F_z\khat \\
&= \frac{24\epsilon}{\sigma^2} \Big[2\Big(\frac{\sigma}{r_{ij}}\Big)^{14} - \Big(\frac{\sigma}{r_{ij}}\Big)^{8} \Big]\Big(x_{ij}\ihat + y_{ij}\jhat + z_{ij}\khat \Big)
\end{align*}



(another section???)

In section \ref{sec: int_methods} we see that to calculate the next time step for the particles we need to calculate the forces. This is very time consuming because we have to sum over all pairs of particles to find the force for one particle. Therefore a lot of time can be saved if the code for the calculation of forces is as efficient as possible.

A better numerical expression for the force is
\begin{align*}
\vec F(r_{ij}) &= \frac{24\epsilon}{\sigma^2} \Big(\frac{\sigma}{r_{ij}}\Big)^2\Big(\frac{\sigma}{r_{ij}}\Big)^6\Big[2\Big(\frac{\sigma}{r_{ij}}\Big)^{6} - 1 \Big]\Big(x_{ij}\ihat + y_{ij}\jhat + z_{ij}\khat \Big)\\
&= 24\epsilon\sigma^6r_{ij}^{-2}r_{ij}^{-6}\big(2\sigma^6r_{ij}^{-6} - 1\big)
\end{align*}
and for the potential energy
\begin{align*}
U(r_{ij}) = 4\epsilon\sigma^6r_{ij}^{-6}\big(\sigma^6r_{ij}^{-6} - 1\big)
\end{align*}
so that the powers of $r_{ij}$ is calculated as few times as possible, $r_{ij}^{-6}$ can be calculated just once for each loop (define?).  

Another smart way to make a more efficient code when calculating the forces is to realize that in the limit $r_{ij}\rightarrow \infty$ both the force and the potential energy is zero. In figure \ref{fig: force_potential} the potential energy (red) and the force (blue) plotted against the distance between two atoms $r_{ij}$. We can see that the energy and the force reaches zero for large values of $r_{ij}$.  The point for which the potential energy and the force is nearly zero, $r_{cut}$, is marked with a dot in the figure. A good approximation is therefore to stop calculating forces and energies for distances larger than $r_{cut}$ and set all forces and energies for $r_{ij} > r_{cut}$ to zero.

\begin{figure}
\centering
\includegraphics[width = 0.8\textwidth]{plots/force_potential.png}
\caption{\textbf{Top:} The Lennard-Jones potential (red), or the potential energy $U(r_{ij})$ between two atoms $i$ and $j$ plotted against the distance between atom $i$ and $j$, $r_{ij}$. The point $(r_{cut},U(r_{cut}))$ is marked with a  red dot. The shifted potential function is also plotted in green. \textbf{Bottom:}  The force (blue) between two atoms $i$ and $j$ plotted against the distance between atom $i$ and $j$, $r_{ij}$. The point $(r_{cut}, F(r_{cut}))$ is marked with a blue dot.}
\label{fig: force_potential}
\end{figure}

The implementation of $r_{cut}$ will save the algorithm a lot of time and still be a good approximation since the force and the potential energy is esensially zero anyway. The only problem is that the potential energy function will be discontinuously at the point $r_{cut}$ when the energy is set to zero after $r_{cut}$. A solution to this is to shift the potential function slightly so that the energy is zero at $r_{cut}$ and still set to zero for $r_{ij}>r_{cut}$. The shifted potential function is marked with green in figure \ref{fig: force_potential}. This will only shift the values for the potential and total energy, but it will not affect the physics of the problem. The statistical properties of the system will not be affected by the shift in energy. 


\paragraph{The minimum image convention} (due to calculation of forces)
When an atom leave the simulation box it must re-enter the box on the opposite side. An atom at the edge of the simulation box must also interact with an atom at the other side of the box 'through' the wall, or interact with the image of the simulation box. But this atom is also contained inside the box so the atoms interact twice, once through the wall and once from across the box. To avoid counting this interaction twice we will apply the minimum image convention. An atom will interact with the other atoms only once and then choose the image (or the simulation box) that gives the minimum distance\footnote{\url{https://en.wikipedia.org/wiki/Periodic\_boundary\_conditions\#Practical\_implementation:\_continuity\_and\_the\_minimum\_image\_convention}}:
%This is because we want to avoid extensive mathematical calculations of pairwise interactions with all particle inside or outside the box. MIC is a way of providing a cutoff distance over which we are not calculating pairwise potential. The cutoff is usually half the box length. This means if distance between particle i and particle j is more than L/2, you will neglect the pairwise potential between i & j, instead you will consider potential between i & neareset image of j, hence the term Minimum Image.

\begin{lstlisting}
if(periodic_x) then
  dx = x(j) - x(i)
  if (dx >   x_size * 0.5) dx = dx - x_size
  if (dx <= -x_size * 0.5) dx = dx + x_size
endif
\end{lstlisting}

(include drawing??)

This leads to two possible strategic choices: (A) 'fold back' particles into the simulation box when they leave it, or (B) let them go on into the other side of the box?

....ahh, this is relevant for computing forces/potentials!
An atom which has passed through one face of the simulation box should re-enter through the opposite face-or its image should do it. Evidently, a strategic decision must be made: Do we (A) “fold back” particles into the simulation box when they leave it, or do we (B) let them go on (but compute interactions with the nearest images)? The decision has no effect on the course of the simulation, but if the user in interested in mean displacements, diffusion lenghts, etc., the second option is preferable.




  
  
\subsection{Calculating physical properties of the system} \label{sec: statistics_theory}
The total potential energy $V$ in the system is computed by summing over all pairs of atoms (counting each pair only once) 
\begin{align}
	V = \sum_{i>j} U(r_{ij}).
\end{align}
where $U(r_{ij})$ are the Lennard-Jones potential given in section \ref{sec: L-Jpot_forces}. The kinetic energy is defined as
\begin{align}
	E_k = \sum_{i=1}^{N_\text{atoms}} \frac{1}{2} m_i v_i^2,
\end{align}
where $m_i$ and $v_i$ is the mass and the speed of atom $i$. The total energy of the system is then $E = V + E_k$. (which we will study if is conserved or not, see $\sigma_E$ ??)

We will also calculate an estimate of the temperature through the equipartition theorem\footnote{See for example D. Schroeder's \textit{An Introduction to Thermal Physics} for details. better reference?}
\begin{align}
	\langle E_k \rangle = \frac{3}{2}N_\text{atoms} k_B T.
\end{align}
We can use this to define an \textit{instantaneous} temperature
\begin{align}
	\label{eq:temperature}
	T = \frac{2}{3}\frac{E_k}{N_\text{atoms} k_B}.
\end{align}


\paragraph{The diffusion constant} of the system can be used to measure the melting temperature. We use the Einstein relation that relates the so called mean square displacement (MSD) to the diffusion constant
\begin{align}
	\langle r^2(t) \rangle = 6Dt,
\end{align}
where $D$ is the diffusion constant, $t$ is time. The mean square displacement for atom $i$ is calculated as
\begin{align}
	r_i^2(t) = |\vec r_i(t) - \vec r_i(0)|^2,
\end{align}
where $\vec r_i(t)$ is the position of atom $i$ at time $t$. 

The diffusion constant is then given by
\begin{align*}
D = \frac{\langle r^2(t) \rangle}{6t} = 
\end{align*}
(for a given temperature ($T_i$ ?).)

Atoms in a solid will not diffuse (move?) much, so a solid will have a diffusion constant close to zero. A plot of the diffusion constant as a function of temperature will therefore reveale the melting temperature because the solid melts when the diffusion constant is non zero.

write something about ovito introduction(?)

%\centering
\rule{0.3\textwidth}{0.4pt}\par % Short horizontal line under the title  

\section{Program flow and folder structure}



\section{Numerical methods and approximations}


\section{Results} %move this to after implementation/testing+

\subsection{Implementation and testing of the algorithm by using Ovito (code?) and choice of parameters}
bla bla bla

\subsubsection*{Looking in \texttt{Ovito}}
\paragraph{Initial positions}
To the left in figure \ref{fig: unitCellsOvito} we see a screen shot of the initial frame of the simulation box with one unit cell from \texttt{Ovito} (ref?). We see that this is exactly the unit cell introduced in section \ref{sec: creating_lattice_theory} and figure \ref{fig: ar_crystal}. To the right in figure \ref{fig: unitCellsOvito} we see a screen shot of the initial frame of the simulation box with 10 unit cells from \texttt{Ovito}, creating a cubic lattice. After looking at the initial frame of the simulation box in \texttt{Ovito} it seems safe to assume that the program produces the desired initial positions for the Argon atoms. 

\begin{figure}[htp]
\centering
\includegraphics[height=0.2\textheight]{plots/OneUnitCell}
\includegraphics[height=0.2\textheight]{plots/10UnitCells}
\caption{\textbf{Left:} A screen shot of the initial frame of the simulation box with one unit cell from \texttt{Ovito}. \textbf{Right:} A screen shot of the initial frame of the simulation box with 10 unit cells from \texttt{Ovito}, creating a cubic lattice.}
\label{fig: unitCellsOvito}
\end{figure}

\paragraph{Before forces}
At first the particles was unaffected by forces in the simulation. Before the Lennard-Jones potential and the calculation of the forces was implemented the particles was only given an initial speed by the maxwell boltzmann distrubution and should thus move in a straight line. In \texttt{Ovito} the particles moved in a straight line, and the simulation box expanded as the particels reached further out. After the periodic boundary conditions was implemented in the code the simulation box maintained a constant size when looked at in \texttt{Ovito}. One could also see that the particles still moved in a straight line, but they would jump to the oposite side of the box if they where to move out of the box. 

After the implementation of the forces one could easy see (in \texttt{Ovito}) that the particles was contained inside the initial crystal structure, for instance at the temperature $T_i =300$K. Just by looking at the simulation one could determine that the atoms formed a solid. At a high temperature, for instance $T_i = 1000K$ one could see that the atoms moved freely and that the crystal or solid most likely had melted. Screen shots igjen??


\subsection{Comparing the two integrators} \label{sec: integrators_results}

In the top plot in figure \ref{fig: dt} we can see the standard deviation of the total energy $\sigma_E$ plotted versus the timestep dt for the Euler-Cromer and Velocity Verlet integrator . The units on the axis are MN unist explained in section (?do it? explain in caption?) We see that the drift in the energy is significantly larger for the Euler-Cromer method than for the Velocity Verlet integrator and that it increases with increasing dt for the Euler-Cromer method. For the Velocity Verlet integrator the choice of dt does not matter much, the energy drift, or the value for $\sigma_E$ is small for all values of dt. In the further calculations we have therefore chosen dt=0.05.  
%this is expected

In the bottom plot in figure \ref{fig: dt} we can see the execution time plotted versus the timestep for the Euler-Cromer and Velocity Verlet integrator. We see that there is not much difference in the execution time between the two integrators and that the dependence on the value of dt seems rather random. 

Both plots in figure \ref{fig: dt} where obtained with 5 unit cells in each direction, initial temperature $T_i = 2.5 \approx 300$ K, lattice constant $b=5.26 \angstrom$ and 1000 timesteps in the simulation. Similar plots are obtained when running with 10 unit cells in each direction. 

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/dt_NrOfCells5_T2500_b5260.png}
\caption{\textbf{Top:} The standard deviation of the total energy $\sigma_E$ plotted versus the timestep dt for the Euler-Cromer and Velocity Verlet integrator with 5 unit cells in each direction, initial temperature $T_i = 2.5 \approx 300$ K, lattice constant $b=5.26 \angstrom$ and 1000 timesteps in the simulation. \textbf{Bottom:} The execution time plotted versus the the timestep dt for the Euler-Cromer and Velocity Verlet integrator with 5 unit cells in each direction, initial temperature $T_i = 2.5 \approx 300$ K, lattice constant $b=5.26 \angstrom$ and 1000 timesteps in the simulation.}
\label{fig: dt}
\end{figure}

In figure \ref{fig: exe_cells} we see the execution time plotted versus the number of unit cells in each direction for the Euler-Cromer and Velocity Verlet integrator. We see that for small number of unit cells the execution time is about the same for both integrators, they are equally fast. For 15 unit cells in each direction the two integrators deviate slightly in the execution time, but the execution time is quite large, $t_{exe} \approx 800 \mathrm{s} \approx 13 \mathrm{min}$ so that the deviation in the execution time between the integrators are small compared to the execution time. Thus the choice of integrator does not affect the execution time much and we should choose the integrator that gives the best physical results. The best physical results are when the drift in the energy or $\sigma_E$ is as small as possible, we should therefore use the Velocity Verlet integrator. The further calculations are done with the Velocity Verlet integrator. 

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/exeTime_NrOfCells_T2500_b5260.png}
\caption{The execution time plotted versus the number of unit cells in each direction for the Euler-Cromer and Velocity Verlet integrator with initial temperature $T_i = 2.5 \approx 300$ K, lattice constant $b=5.26 \angstrom$, $dt=0.05\approx  5\cdot 10^{-15}$s and 1000 timesteps in the simulation.}
\label{fig: exe_cells}
\end{figure}

number of unit cells is also a measure of how many particles..include?


\subsection{Equilibium time? and conserved energy}
(conserved, ref to rcut?)
In figure \ref{fig: Energy_time1} we see the energy plotted versus the time with initial temperature $T_i = 2.5 \approx 300$ K for two different number of unit cells in each direction. We see that the total energy is conserved, or constant. This coresponds well with the low value of $\sigma_E$ found in section \ref{sec: integrators_results} (figure \ref{fig: dt}). We can see that the system is initialized with high kinetic energy and low potential energy and that the two interchanges energy giving that the total energy is conserved. The system stabilizes after a short period of time, it reaches an equilibrium state when the kinetic and potential energy fluctuates around a constant energy. The equilibrium state is reached at least for $t=10$, or after 20 timesteps. 

The kinetic energy drops below the equilibrium value before it stabilizes. This is because the particles are all initialized with different velocities and move until they are stoped, at about the same time, by the forces of the surrounding particles before they find an equilibrium position and oscillates around this position.  

The top plot in figure \ref{fig: Energy_time1} is obtained with 5 unit cells in each direction and the bottom plot is obtained with 10 unit cells in each direction. We see that the plot with only 5 unit cells fluctuates more after equilibrium than the plot with 10 unit cells. 

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/Energy_time_T25.png}
\caption{The kinetic (blue), potential (green) and total (red) energy plotted versus the time with initial temperature $T_i = 2.5 \approx 300$ K, lattice constant $b=5.26 \angstrom$, $dt=0.05\approx  5\cdot 10^{-15}$s and 1000 timesteps in the simulation. \textbf{Top:} 5 unit cells in each direction. \textbf{Bottom:} 10 unit cells in each direction.}
\label{fig: Energy_time1}
\end{figure}

In figure \ref{fig: Energy_time2} we also see the energy plotted versus the time, but with the initial tempererature $T_i = 8.35 \approx 1000$ K. The initial temperature is a lot larger than in figure \ref{fig: Energy_time1} so the system have a higher initial kinetic and potential energy giving a higher total energy. The total energy is still conserved but a larger amount of the energy now comes from the kinetic energy than in figure \ref{fig: Energy_time1}. The time the system uses to reach equilibrium is about the same as for $T_i=2.5$. We notice that the fluctiations after reaching equilibrium is larger for 5 unit cells (top) than for 10 unit cells (bottom) in figure \ref{fig: Energy_time2}. The flutuations are even larger for $T=8.35$ than for $T=2.5$. 

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/Energy_time_T835.png}
\caption{The kinetic (blue), potential (green) and total (red) energy plotted versus the time with initial temperature $T_i = 8.35 \approx 1000$ K, lattice constant $b=5.26 \angstrom$, $dt=0.05\approx  5\cdot 10^{-15}$s and 1000 timesteps in the simulation. \textbf{Top:} 5 unit cells in each direction. \textbf{Bottom:} 10 unit cells in each direction.}
\label{fig: Energy_time2}
\end{figure}

In figure \ref{fig: T_time1} we see the instant temperature $T$ plotted versus the time with initial temperature $T_i = 2.5 \approx 300$ K. Right after initializing the temperature drops quickly below the equilibrium value. This behaviour can also be observed in the kinetic energy in figure \ref{fig: Energy_time1} and \ref{fig: Energy_time2}. Since the instant temperature is proportional to the kinetic energy (see section \ref{sec: statistics_theory}) it is expected that the two curves have the same behaviour.

As in the plots with the energy the value for the instant temperature stabilizes quicly and oscillates around a constant value. It is therefore safe to assume that the system has reached equilibrium after at least 100 timesteps. In the following calculations we have used 10000 timesteps which is long after the system have reached equilibrium. 

The fluctuations in the temperature is as for the energy larger for the plot with 5 unit cells in each direction than with 10 unit cells. The fluctuations are even larger in figure \ref{fig: T_time2} where the instant temperature $T$ plotted versus the time with initial temperature $T_i = 8.35 \approx 1000$ K. It apeares as if the system is more unstable and 'noisy' for small temperatures and few unit cells. Even though the trend is that the data obtained with a larger number of unit cells is more stable than with few unit cells, we have chosen to use 5 unit cells in each direction in the following calculations. This is to save time, the execution time for 10 unit cells are quite long compared with the execution time for 5 unit cells. 

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/T_time_T25.png}
\caption{The instant temperature $T$ plotted versus the time with initial temperature $T_i = 2.5 \approx 300$ K, lattice constant $b=5.26 \angstrom$, $dt=0.05\approx  5\cdot 10^{-15}$s and 1000 timesteps in the simulation. \textbf{Top:} 5 unit cells in each direction. \textbf{Bottom:} 10 unit cells in each direction.}
\label{fig: T_time1}
\end{figure}

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/T_time_T835.png}
\caption{The instant temperature $T$ plotted versus the time with initial temperature $T_i = 8.35 \approx 1000$ K, lattice constant $b=5.26 \angstrom$, $dt=0.05\approx  5\cdot 10^{-15}$s and 1000 timesteps in the simulation. \textbf{Top:} 5 unit cells in each direction. \textbf{Bottom:} 10 unit cells in each direction.}
\label{fig: T_time2}
\end{figure}

\paragraph{The temperature ratio}

In figure \ref{fig: TTi_time} we see the ratio between the instant temperature $T$ and the initial temperature $T_i$ plotted versus the time for the initial temperatures $T_i \in [0.5, 18.5]$. We see that the eqiulibrium state is reached for all of the temperatures after the time $t=10$, as also seen in the energy plots. 

The ratio $T/T_i$ is not equal for all of the initial temperatures, but it does center around the value 0.5 so that:
\begin{align*}
T/T_i &\approx \frac{1}{2} \\
\Rightarrow T &\approx \frac{T_i }{2} 
\end{align*}
so from the initial value the temperature will approximately drop to half after the equilibrium state is reached. 

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/TTi_time.png}
\caption{The ratio between the instant temperature $T$ and the initial temperature $T_i$ plotted versus the time (first 500 timesteps) for initial temperatures $T_i \in [0.5, 18.5]$, lattice constant $b=5.26 \angstrom$ and $dt=0.05\approx  5\cdot 10^{-15}$.}
\label{fig: TTi_time}
\end{figure}

\subsection{The mean square displacement and the diffusion constant}

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/D_r2_time.png}
\caption{\textbf{Top:} The diffusion constant $D$ plotted versus the time with 10000 timesteps for initial temperatures $T_i \in [0.5, 18.5]$. \textbf{Bottom:} The mean square displacement $\langle r^2(t) \rangle$ of the particles plotted versus the time with 10000 timesteps for initial temperatures $T_i \in [0.5, 18.5]$. The units are the MD units listed in section (ref???!).}
\label{fig: D_r2_time}
\end{figure}

In figure \ref{fig: D_r2_time} we see the diffusion constant (top) and the mean square displacement (bottom) for the particles plotted versus the time for initial temperatures $T_i \in [3.5, 6.5]$. We can see that the diffusion constant diverges against a constant value for large values for the time. The highest temperatures have the largest values for all temperatures, but it is difficult to tell the different initial temperatures apart by looking at this plot. After 10000 timesteps the diffusion constant have still not stabilized entirely, but we will take the diffusion constant after 10000 timesteps to be the diffusion constant after equilibrium. 

It is easier to tell the initial temperatures apart in the bottom plot in figure \ref{fig: D_r2_time}. We can see that the mean square displacement of the particles is zero for the low temperatures and that it for higher temperatures starts to grow for larger values of the time. When the system is in a solid state it is expected that the diffusion constant is be zero, or that $\langle r^2(t) \rangle$ is zero. For higher temperatures the diffusion constant would be non-zero giving the slope seen for higher temperatures in the $\langle r^2(t) \rangle$ plot. It is hard to tell eqactly for which instant temperature the system melts, but it must be in the range with initial temperatures $T_i \in [3.5, 6.5]$.

\begin{figure}[htp]
\centering
\includegraphics[width=0.6\textwidth]{plots/D_T.png}
\caption{\textbf{Top:} The temperature ratio $T/T-i$ plotted versus the instant temperature $T$ with 10000 timesteps. \textbf{Bottom:} The diffusion constant after reaching equilibrium $D_{eq}$ plotted versus the instant temperature $T$ with 10000 timesteps. The units are the MD units listed in section (ref???!).}
\label{fig: D_T}
\end{figure}

In figure \ref{fig: D_T} we see the temperature ratio $T/T-i$ (top) and the diffusion constant (bottom) after reaching equilibrium $D_{eq}$ plotted versus the instant temperature $T$ with 10000 timesteps. Clearly somerthing is happening at $T=2.3$....but also a lot of noise plobably from that unit cells is 5

2.3 in corrrect units!

or observations in ovito here?


units and experimental data?

\section{Conclusions and further perspectices/experiences}
2.3 in corrrect units! With pressure bla bla bla

\centering
\rule{0.3\textwidth}{0.4pt}\par % Short horizontal line under the title  

\end{document}







